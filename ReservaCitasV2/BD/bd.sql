-- --------------------------------------------------------
-- Host:                         127.0.0.1
-- Versión del servidor:         11.4.0-MariaDB - mariadb.org binary distribution
-- SO del servidor:              Win64
-- HeidiSQL Versión:             12.3.0.6589
-- --------------------------------------------------------

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;


-- Volcando estructura de base de datos para reserva_citas
DROP DATABASE IF EXISTS `reserva_citas`;
CREATE DATABASE IF NOT EXISTS `reserva_citas` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci */;
USE `reserva_citas`;

-- Volcando estructura para procedimiento reserva_citas.SP_ACCOUNT_LOGIN
DROP PROCEDURE IF EXISTS `SP_ACCOUNT_LOGIN`;
DELIMITER //
CREATE PROCEDURE `SP_ACCOUNT_LOGIN`(
	IN `PARAM_VC_DNI` VARCHAR(50),
	IN `PARAM_VC_PASSWORD` VARCHAR(50)
)
BEGIN

	SELECT
		ID_PACIENTE,
		VC_DNI,
		VC_PASS,
		CH_SITUACION_REGISTRO
	FROM ta_paciente
	WHERE
		VC_DNI = PARAM_VC_DNI
		AND VC_PASS = PARAM_VC_PASSWORD;
		
END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_CITA_CANCELAR
DROP PROCEDURE IF EXISTS `SP_CITA_CANCELAR`;
DELIMITER //
CREATE PROCEDURE `SP_CITA_CANCELAR`(
	IN `PARAM_ID_CITA` INT
)
BEGIN

	UPDATE ta_citas
	SET
		CH_SITUACION_REGISTRO = "E"
	WHERE ID_CITA = PARAM_ID_CITA;

END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_CITA_CREAR
DROP PROCEDURE IF EXISTS `SP_CITA_CREAR`;
DELIMITER //
CREATE PROCEDURE `SP_CITA_CREAR`(
	IN `PARAM_IN_ID_DOCTOR` INT,
	IN `PARAM_IN_ID_PACIENTE` INT,
	IN `PARAM_IN_ID_LOCAL` INT,
	IN `PARAM_DT_FECHA` DATE,
	IN `PARAM_IN_ID_ESPECIALIDAD` INT,
	IN `PARAM_HR_HORA` VARCHAR(50)
)
BEGIN
	
	INSERT INTO ta_citas(
		IN_ID_DOCTOR,
		IN_ID_PACIENTE,
		IN_ID_LOCAL,
		DT_FECHA,
		CH_SITUACION_REGISTRO,
		HR_HORA,
		IN_ID_ESPECIALIDAD
	)
	VALUES (
		PARAM_IN_ID_DOCTOR,
		PARAM_IN_ID_PACIENTE,
		PARAM_IN_ID_LOCAL,
		PARAM_DT_FECHA,
		"A",
		PARAM_HR_HORA,
		PARAM_IN_ID_ESPECIALIDAD
	);
	
	
END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_CITA_LISTAR
DROP PROCEDURE IF EXISTS `SP_CITA_LISTAR`;
DELIMITER //
CREATE PROCEDURE `SP_CITA_LISTAR`()
BEGIN

	SELECT
		C.ID_CITA,
		C.DT_FECHA,
		C.HR_HORA,
		E.VC_NOMRBE,
		D.VC_NOMBRE AS NOMBRE_DOCTOR
	FROM ta_citas C
	LEFT JOIN ta_especialidad E
		ON C.IN_ID_ESPECIALIDAD = E.ID_ESPECIALIDAD
	LEFT JOIN ta_doctor D
		ON C.IN_ID_DOCTOR = D.ID_DOCTOR
	WHERE
		C.CH_SITUACION_REGISTRO = "A"
		AND C.DT_FECHA < CURDATE() OR (C.DT_FECHA = CURDATE() AND STR_TO_DATE(C.HR_HORA, '%H:%i') < CURTIME())
	ORDER BY C.DT_FECHA, C.HR_HORA;

END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_CITA_LISTAR_PROGRAMADA
DROP PROCEDURE IF EXISTS `SP_CITA_LISTAR_PROGRAMADA`;
DELIMITER //
CREATE PROCEDURE `SP_CITA_LISTAR_PROGRAMADA`()
BEGIN

	SELECT
		C.ID_CITA,
		C.DT_FECHA,
		C.HR_HORA,
		E.VC_NOMRBE,
		D.VC_NOMBRE AS NOMBRE_DOCTOR
	FROM ta_citas C
	LEFT JOIN ta_especialidad E
		ON C.IN_ID_ESPECIALIDAD = E.ID_ESPECIALIDAD
	LEFT JOIN ta_doctor D
		ON C.IN_ID_DOCTOR = D.ID_DOCTOR
	WHERE
		C.CH_SITUACION_REGISTRO = "A"
		AND C.DT_FECHA > CURDATE() OR (C.DT_FECHA = CURDATE() AND STR_TO_DATE(C.HR_HORA, '%H:%i') > CURTIME())
	ORDER BY C.DT_FECHA, C.HR_HORA;

END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_CITA_REPROGRAMAR
DROP PROCEDURE IF EXISTS `SP_CITA_REPROGRAMAR`;
DELIMITER //
CREATE PROCEDURE `SP_CITA_REPROGRAMAR`(
	IN `PARAM_DT_FECHA` DATE,
	IN `PARAM_HR_HORA` VARCHAR(50),
	IN `PARAM_ID_CITA` INT
)
BEGIN

	UPDATE ta_citas
	SET
		DT_FECHA = PARAM_DT_FECHA,
		HR_HORA = PARAM_HR_HORA
	WHERE ID_CITA = PARAM_ID_CITA;

END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_DOCTOR_LISTAR
DROP PROCEDURE IF EXISTS `SP_DOCTOR_LISTAR`;
DELIMITER //
CREATE PROCEDURE `SP_DOCTOR_LISTAR`()
BEGIN

	SELECT
		D.ID_DOCTOR,
		D.VC_NOMBRE,
		D.IN_ID_ESPECIALIDAD,
		E.VC_NOMRBE AS NOMBRE_ESPECIALIDAD
	FROM ta_doctor D
		LEFT JOIN ta_especialidad E
			ON D.IN_ID_ESPECIALIDAD = E.ID_ESPECIALIDAD
	WHERE
		D.CH_SITUACION_REGISTRO = "A";

END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_ESPECIALIDAD_LISTAR
DROP PROCEDURE IF EXISTS `SP_ESPECIALIDAD_LISTAR`;
DELIMITER //
CREATE PROCEDURE `SP_ESPECIALIDAD_LISTAR`()
BEGIN
	
	SELECT
		ID_ESPECIALIDAD,
		VC_NOMRBE
	FROM ta_especialidad
	WHERE CH_SITUACION_REGISTRO = "A";

END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_LOCAL_LISTAR
DROP PROCEDURE IF EXISTS `SP_LOCAL_LISTAR`;
DELIMITER //
CREATE PROCEDURE `SP_LOCAL_LISTAR`()
BEGIN

	SELECT
		ID_LOCAL,
		VC_NOIMBRE,
		VC_DIRECCION
	FROM ta_local
	WHERE CH_SITUACION_REGISTRO = "A";

END//
DELIMITER ;

-- Volcando estructura para procedimiento reserva_citas.SP_USUARIO_OBTENER
DROP PROCEDURE IF EXISTS `SP_USUARIO_OBTENER`;
DELIMITER //
CREATE PROCEDURE `SP_USUARIO_OBTENER`(
	IN `PARAM_ID_USUARIO` INT
)
BEGIN

	SELECT
		P.ID_PACIENTE,
		P.VC_NOMBRE,
		P.VC_EDAD,
		P.VC_SEXO,
		S.NOMBRE AS VC_SEGURO,
		P.VC_PESO,
		P.VC_ALTURA,
		P.VC_DNI,
		P.VC_PASS
	FROM ta_paciente P
	LEFT JOIN ta_seguro S
		ON P.IN_ID_SEGURO = S.ID_SEGURO
	WHERE P.ID_PACIENTE = PARAM_ID_USUARIO;

END//
DELIMITER ;

-- Volcando estructura para tabla reserva_citas.ta_citas
DROP TABLE IF EXISTS `ta_citas`;
CREATE TABLE IF NOT EXISTS `ta_citas` (
  `ID_CITA` int(11) NOT NULL AUTO_INCREMENT,
  `IN_ID_DOCTOR` int(11) DEFAULT NULL,
  `IN_ID_ESPECIALIDAD` int(11) DEFAULT NULL,
  `IN_ID_PACIENTE` int(11) DEFAULT NULL,
  `IN_ID_LOCAL` int(11) DEFAULT NULL,
  `DT_FECHA` date DEFAULT NULL,
  `HR_HORA` varchar(50) DEFAULT NULL,
  `CH_SITUACION_REGISTRO` char(1) DEFAULT NULL,
  PRIMARY KEY (`ID_CITA`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Volcando datos para la tabla reserva_citas.ta_citas: ~15 rows (aproximadamente)
DELETE FROM `ta_citas`;
INSERT INTO `ta_citas` (`ID_CITA`, `IN_ID_DOCTOR`, `IN_ID_ESPECIALIDAD`, `IN_ID_PACIENTE`, `IN_ID_LOCAL`, `DT_FECHA`, `HR_HORA`, `CH_SITUACION_REGISTRO`) VALUES
	(1, 3, 7, 1, 2, '2024-04-20', '07:30', 'A'),
	(2, 1, 1, 1, 1, '2024-04-26', '07:30', 'A'),
	(3, 3, 8, 1, 1, '2024-04-18', '08:00', 'A'),
	(4, 2, 1, 1, 1, '2024-04-30', '09:00', 'A'),
	(5, 5, 9, 1, 1, '2024-04-26', '09:00', 'A'),
	(6, 2, 1, 1, 2, '2024-04-22', '10:00', 'A'),
	(7, 1, 6, 1, 1, '2024-04-24', '09:30', 'A'),
	(8, 4, 1, 1, 2, '2024-04-26', '08:00', 'A'),
	(9, 2, 1, 1, 2, '2024-04-24', '10:00', 'A'),
	(10, 5, 42, 1, 1, '2024-04-22', '08:00', 'A'),
	(11, 2, 1, 1, 2, '2024-04-12', '10:00', 'A'),
	(12, 3, 7, 1, 2, '2024-04-21', '08:30', 'A'),
	(13, 4, 5, 1, 2, '2024-04-21', '08:00', 'A'),
	(14, 2, 4, 1, 1, '2024-04-20', '07:30', 'A'),
	(15, 2, 7, 1, 1, '2024-04-21', '08:00', 'A');

-- Volcando estructura para tabla reserva_citas.ta_doctor
DROP TABLE IF EXISTS `ta_doctor`;
CREATE TABLE IF NOT EXISTS `ta_doctor` (
  `ID_DOCTOR` int(11) NOT NULL AUTO_INCREMENT,
  `VC_NOMBRE` varchar(50) DEFAULT NULL,
  `IN_ID_ESPECIALIDAD` int(11) DEFAULT NULL,
  `CH_SITUACION_REGISTRO` char(1) DEFAULT NULL,
  PRIMARY KEY (`ID_DOCTOR`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Volcando datos para la tabla reserva_citas.ta_doctor: ~6 rows (aproximadamente)
DELETE FROM `ta_doctor`;
INSERT INTO `ta_doctor` (`ID_DOCTOR`, `VC_NOMBRE`, `IN_ID_ESPECIALIDAD`, `CH_SITUACION_REGISTRO`) VALUES
	(1, 'Dr. Monrroy', 1, 'A'),
	(2, 'Dr. Garcia', 2, 'A'),
	(3, 'Dr. Gareca', 2, 'A'),
	(4, 'Dr. Milos', 2, 'A'),
	(5, 'Dra. María', 3, 'A'),
	(6, 'Dr. Jose', 4, 'A');

-- Volcando estructura para tabla reserva_citas.ta_especialidad
DROP TABLE IF EXISTS `ta_especialidad`;
CREATE TABLE IF NOT EXISTS `ta_especialidad` (
  `ID_ESPECIALIDAD` int(11) NOT NULL AUTO_INCREMENT,
  `VC_NOMRBE` varchar(50) DEFAULT NULL,
  `CH_SITUACION_REGISTRO` char(1) DEFAULT NULL,
  PRIMARY KEY (`ID_ESPECIALIDAD`)
) ENGINE=InnoDB AUTO_INCREMENT=54 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Volcando datos para la tabla reserva_citas.ta_especialidad: ~48 rows (aproximadamente)
DELETE FROM `ta_especialidad`;
INSERT INTO `ta_especialidad` (`ID_ESPECIALIDAD`, `VC_NOMRBE`, `CH_SITUACION_REGISTRO`) VALUES
	(1, 'TRAUMATOLOGIA', 'A'),
	(2, 'MEDICINA FISICA - REHABILITACION', 'A'),
	(3, 'ALERGIA E INMUNOLOGIA', 'A'),
	(4, 'CARDIOLOGIA CLINICA HEMODINAMICA', 'A'),
	(5, 'CARDIOLOGIA PEDIATRICA', 'A'),
	(6, 'CIRUG.CABEZA - CUELLO MAXILOFACIAL', 'A'),
	(7, 'CIRUGIA CARDIOVASCULAR', 'A'),
	(8, 'CIRUGIA DE TORAX', 'A'),
	(9, 'CIRUGIA GENERAL', 'A'),
	(10, 'CIRUGIA ONCOLOGICA', 'A'),
	(11, 'CIRUGIA ORAL Y MAXILO FACIAL', 'A'),
	(12, 'CIRUGIA PEDIATRICA', 'A'),
	(13, 'CIRUGIA TORACICA Y CARDIOVASCULAR', 'A'),
	(14, 'CIRUGIA VASCULAR PERIFERICA', 'A'),
	(15, 'CIRUG.PLASTICA ESTET.QUEMADOS', 'A'),
	(16, 'DERMATOLOGIA', 'A'),
	(17, 'DERMATOLOGIA PEDIATRICA', 'A'),
	(18, 'ENDOCRINOLOGIA', 'A'),
	(19, 'ENDOCRINOLOGIA PEDIATRICA', 'A'),
	(20, 'ENDODONCIA', 'A'),
	(21, 'GASTROENTEROLOGIA', 'A'),
	(22, 'GENETICA MEDICA', 'A'),
	(23, 'GERIATRIA', 'A'),
	(24, 'GINECOLOGIA ONCOLOGICA', 'A'),
	(25, 'GINECO - OBSTETRICIA', 'A'),
	(26, 'HEMATOLOGIA CLINICA', 'A'),
	(27, 'MASTOLOGIA', 'A'),
	(28, 'MEDICINA DE ENFERMEDADES INFECCIOSAS Y TROPICALES', 'A'),
	(29, 'MEDICINA HIPERBARICA', 'A'),
	(30, 'MEDICINA INTERNA', 'A'),
	(31, 'NEFROLOGIA', 'A'),
	(32, 'NEFROLOGIA PEDIATRICA', 'A'),
	(33, 'NEUMOLOGIA', 'A'),
	(34, 'NEUMOLOGIA PEDIATRICA', 'A'),
	(35, 'NEUROCIRUGIA', 'A'),
	(36, 'NEUROCIRUGIA PEDIATRICA', 'A'),
	(37, 'NEUROLOGIA', 'A'),
	(38, 'NEUROPSICOLOGÌA', 'A'),
	(39, 'NUTRICIONISTA', 'A'),
	(40, 'ODONTOLOGIA', 'A'),
	(41, 'ODONTOPEDIATRIA', 'A'),
	(42, 'OFTALMOLOGIA', 'A'),
	(43, 'OFTALMOLOGIA PEDIATRICA', 'A'),
	(44, 'ONCOLOGIA MEDICA', 'A'),
	(45, 'ORTODONCIA Y ORTOPEDIA MAXILAR', 'A'),
	(46, 'OTORRINO LARINGOLOGIA', 'A'),
	(47, 'PEDIATRIA Y NEONATOLOGIA', 'A'),
	(48, 'PSICOLOGIA', 'A'),
	(49, 'PSICOLOGIA INFANTIL', 'A'),
	(50, 'PSIQUIATRIA', 'A'),
	(51, 'REUMATOLOGIA', 'A'),
	(52, 'TERAPIA DE LENGUAJE Y APRENDIZAJE', 'A'),
	(53, 'UROLOGIA', 'A');

-- Volcando estructura para tabla reserva_citas.ta_local
DROP TABLE IF EXISTS `ta_local`;
CREATE TABLE IF NOT EXISTS `ta_local` (
  `ID_LOCAL` int(11) NOT NULL AUTO_INCREMENT,
  `VC_NOIMBRE` varchar(50) DEFAULT NULL,
  `VC_DIRECCION` varchar(50) DEFAULT NULL,
  `CH_SITUACION_REGISTRO` char(1) DEFAULT NULL,
  PRIMARY KEY (`ID_LOCAL`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Volcando datos para la tabla reserva_citas.ta_local: ~2 rows (aproximadamente)
DELETE FROM `ta_local`;
INSERT INTO `ta_local` (`ID_LOCAL`, `VC_NOIMBRE`, `VC_DIRECCION`, `CH_SITUACION_REGISTRO`) VALUES
	(1, 'Local Principal', 'Javier Prado', 'A'),
	(2, 'Local Rambla', 'Aviacion con Javier Prado', 'A');

-- Volcando estructura para tabla reserva_citas.ta_paciente
DROP TABLE IF EXISTS `ta_paciente`;
CREATE TABLE IF NOT EXISTS `ta_paciente` (
  `ID_PACIENTE` int(11) NOT NULL AUTO_INCREMENT,
  `VC_NOMBRE` varchar(50) DEFAULT NULL,
  `VC_EDAD` varchar(50) DEFAULT NULL,
  `VC_SEXO` varchar(50) DEFAULT NULL,
  `IN_ID_SEGURO` int(11) DEFAULT NULL,
  `VC_PESO` varchar(50) DEFAULT NULL,
  `VC_ALTURA` varchar(50) DEFAULT NULL,
  `VC_DNI` varchar(50) DEFAULT NULL,
  `VC_PASS` varchar(50) DEFAULT NULL,
  `CH_SITUACION_REGISTRO` char(1) DEFAULT NULL,
  PRIMARY KEY (`ID_PACIENTE`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Volcando datos para la tabla reserva_citas.ta_paciente: ~1 rows (aproximadamente)
DELETE FROM `ta_paciente`;
INSERT INTO `ta_paciente` (`ID_PACIENTE`, `VC_NOMBRE`, `VC_EDAD`, `VC_SEXO`, `IN_ID_SEGURO`, `VC_PESO`, `VC_ALTURA`, `VC_DNI`, `VC_PASS`, `CH_SITUACION_REGISTRO`) VALUES
	(1, 'Rolando Zafra', '21', 'Masculino', 1, '81.5', '1.82', '70998706', 'Patatas123', 'A');

-- Volcando estructura para tabla reserva_citas.ta_seguro
DROP TABLE IF EXISTS `ta_seguro`;
CREATE TABLE IF NOT EXISTS `ta_seguro` (
  `ID_SEGURO` int(11) NOT NULL AUTO_INCREMENT,
  `NOMBRE` varchar(50) DEFAULT NULL,
  `CH_SITUACION_REGISTRO` char(1) DEFAULT NULL,
  PRIMARY KEY (`ID_SEGURO`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Volcando datos para la tabla reserva_citas.ta_seguro: ~2 rows (aproximadamente)
DELETE FROM `ta_seguro`;
INSERT INTO `ta_seguro` (`ID_SEGURO`, `NOMBRE`, `CH_SITUACION_REGISTRO`) VALUES
	(1, 'PACIFICO EPS', 'A'),
	(2, 'EPS SANITAS', 'A'),
	(3, 'RIMAC SEGUROS', 'A');

/*!40103 SET TIME_ZONE=IFNULL(@OLD_TIME_ZONE, 'system') */;
/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 1) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40111 SET SQL_NOTES=IFNULL(@OLD_SQL_NOTES, 1) */;
